'use strict';function n(b){this.position=b}const r=function(){var b={};Array.from('"\\/bfnrtu').forEach(d=>b[d]=!0);return b}(),t=/[0-9a-fA-F]/;
function u(b,d){function e(a){return b.substring(g,g+a.length)===a}function c(a){if(!e(a))throw new n(g);g+=a.length}function f(){var a=/[^\s]/g;a.lastIndex=g;g=(a=a.exec(b))?a.index:b.length}function k(){return b.charAt(g)}function h(){++g;return k()}var g=d||0;"number"!==typeof g&&(g=0);const m={s:function(){c('"');for(var a=!1;'"'!==b.charAt(g)||a;)if(a){if("u"===k())for(++g,a=0;4>a;++a){if(!t.test(k()))throw new n(g);++g}else if(r[k()])++g;else throw new n(g);a=!1}else a="\\"===k()?!0:!1,++g;
c('"')},n:function(){var a=k();for("-"===a&&(a=h());"0"<=a&&"9">=a;)a=h();if("."===a)for(a=h();"0"<=a&&"9">=a;)a=h();if("e"===a||"E"===a){a=h();if("+"===a||"-"===a)a=h();for(;"0"<=a&&"9">=a;)a=h()}},k:function(){[!0,!1,null].map(String).find(function(a){return e(a)?(c(a),!0):!1})},o:function(){c("{");for(f();!e("}");){m.s();f();c(":");m._();f();if(e("}"))break;c(",");f();if(e("}"))throw new n(g);}++g},a:function(){c("[");for(f();!e("]");){m._();f();if(e("]"))break;c(",");f();if(e("]"))throw new n(g);
}++g},_:function(){f();var a=k(),l={tfn:"k","{":"o","[":"a","-0123456789":"n",'"':"s"},p;for(p in l)if(1<p.length)for(var q of p)l[q]=l[p];if((a=l[a])&&m[a])m[a].call(m);else throw new n(g);}};m._();return g}function v(b){return new Promise((d,e)=>{var c=new FileReader;c.onload=function(){d(c.result)};c.onerror=function(){e("error loading file")};c.readAsText(b,"UTF-8")})}function w(b,d){d=d||0;for(var e=[],c=0;c<b.length;){var f=40-d;d=0;e.push(b.substring(c,c+f));c+=f}return e}
function x(b,d){var e=document.createElement("span");d&&(e.className=d);e.textContent=b;return e}function y(b,d,e){var c=document.createElement("span");c.className=d;for(var f of Array.from(b))" "<=f?(b=x(f,null),e.push(b),c.appendChild(b)):c.appendChild(document.createTextNode(f));c.normalize();return c}function z(b){return" ">b?String.fromCharCode(9216+b.charCodeAt(0)):b}
function A(b,d){var e=null,c=/\s+/g;console.log("File size in characters: "+b.length);var f=0,k=document.querySelector(".error.hidden");k.parentNode.appendChild(k.cloneNode(!0));k.classList.remove("hidden");try{for(;null===e||e<b.length;){c.lastIndex=e;var h=c.exec(b);h.index===e&&(e+=h[0].length);if(e>=b.length)break;e=u(b,e);++f}console.log("Number of records: "+f);k.textContent=d?d+" is correct":"Correct";k.classList.add("correct")}catch(a){if(a instanceof n){console.log("Number of records before the error: "+
f);k.classList.remove("correct");f=c=0;e=[];for(h=0;h<a.position;++h)"\n"===b.charAt(h)?(++c,f=0):++f;h="Error";d&&(h+=" in "+d);k.textContent=h+" at position "+a.position+" row "+(c+1)+" column "+(f+1);d=document.createElement("pre");c=a.position-260;0>c&&(c=0);f=c+520;f>b.length&&(f=b.length);f=b.substring(c,f);b=w(f.substring(0,a.position-c),0);c=w(f.substring(a.position-c),(b[b.length-1]||"").length);d.appendChild(y(b.map(l=>Array.from(l).map(z).join("")).join("\n"),"before",e));d.appendChild(x("",
"marker"));d.appendChild(y(c.map(l=>Array.from(l).map(z).join("")).join("\n"),"after",e));b=document.createElement("div");b.classList.add("outer");b.appendChild(d);k.appendChild(b);var g=Math.max(...e.map(l=>l.offsetWidth));if(8<g){var m=g+"px";e.forEach(l=>{l.style.fontStretch=100*g/l.offsetWidth+"%";l.style.width=m})}}else throw a;}}function B(b){v(b).then(d=>A(d,b.name)).catch(d=>{console.error(d)})}
((b,d)=>{function e(a,l){var p=!1;Array.prototype.slice.call(a.files).forEach(function(q){p=!0;d(q,l)});return p}function c(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy";a.currentTarget.classList.add("dragOver")}function f(a){a.stopPropagation();a.preventDefault();e(a.dataTransfer,a);a.currentTarget.classList.remove("dragOver")}function k(a){a.currentTarget.classList.add("dragOver")}function h(a){a.currentTarget.classList.remove("dragOver")}const g={};var m=!1;g.bind=
()=>{m=!0;b.addEventListener("dragover",c,!1);b.addEventListener("drop",f,!1);b.addEventListener("dragenter",k,!1);b.addEventListener("dragleave",h,!1)};g.g=()=>{m&&(b.removeEventListener("dragover",c,!1),b.removeEventListener("drop",f,!1),b.removeEventListener("dragenter",k,!1),b.removeEventListener("dragleave",h,!1),m=!1)};g.bind();return g})(document.body,B);
document.addEventListener("paste",b=>{b=Array.from(b.clipboardData.items);for(var d of b)"file"===d.kind&&(d.name&&console.log("Found a file: ",d.name),B(d.getAsFile())),"string"===d.kind&&"text/plain"===d.type?d.getAsString(e=>A(e,"<pasted text>")):console.log("Don't know what to do with this:",d.kind,d.type)});document.querySelector("input[type=file]").addEventListener("change",b=>Array.from(b.target.files).forEach(B));
